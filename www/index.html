<html>
<head>
<title>Nodent ES7 to ES5 compiler</title>
<style>
span {
  width:48%;
  height:70%;
  display: inline-block;
}
textarea {
  width:100%;
  height:100%;
}
pre {
  max-height: 15%;
  border: 1px solid #888;
  overflow-x: scroll;
}
pre div:last-child {
  background-color: #ddf;
  color: #448;
}
</style>
<script>
function $error(ex) {
  alert("Unhandled error"+ex.toString()) ;
}

function log() {
  var l = document.getElementById("log") ;
  var line = document.createElement("div") ;
  line.innerText = Array.prototype.slice.call(arguments).join(",")+"\n" ; 
  l.appendChild(line) ;
  line.scrollIntoView(false) ;
}
console.log = log ;

function compile() {
  var src = document.getElementById("source").value ;
  if (!src)
    return ;
  window.location.hash = src ;	

  var xhr = new XMLHttpRequest() ;
  xhr.open("POST",document.getElementById("promise").checked?"/promise":"/es7",true) ;
  xhr.onreadystatechange = function(){
    if (xhr.readyState==4) {
      if (xhr.status!=200) {
        log(xhr.status+": "+xhr.responseText);
        return ;
      }
      try {
  	var resp = JSON.parse(xhr.responseText) ;
        document.getElementById("es5").value = resp.compiled ;
        if (resp.message)
          log(resp.message) ;
      } catch (ex) {
        log(ex.message) ;
      }
    }
  };
  xhr.send(src) ;
}

function execute() {
  try {
    (new Function(document.getElementById("es5").value))() ;
  } catch (ex) {
    log(ex.message) ;
  }  
}

window.onload = function() {
	if (window.location.hash)
		document.getElementById("source").value = window.location.hash.substring(1) ;	
}

</script>
</head>
<body>
<div>
<h2>Nodent ES7 to ES5 compiler</h2>
Install me from <a href="https://www.npmjs.com/package/nodent">npmjs</a>.
Fork me on <a href="https://github.com/MatAtBread/nodent">Github</a>.
</div>
<span>
<textarea id="source">
//ES7 code
</textarea>
<div><button onclick="compile()">Compile</button>
<input type="checkbox" id="promise" checked>Use Promises</div>
</span>
<span>
<textarea id="es5"></textarea>
<div><button onclick="execute()">Run compiled JavaScript</button></div>
</span>
<pre id="log"></pre>
</body>
</html>
